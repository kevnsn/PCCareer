var datastring,dataarray,searchstring,locationstring,pages,currpage,test,app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){document.addEventListener("backbutton",function(){$("#jobcontainer").hide();$("#resultcontainer").show()},!0);navigator.splashscreen.hide()}};
function addForm(){$("#requestbutton").click(function(){$("body").addClass("loading");checkSubmit()});$("#nextbutton").click(function(){$("body").addClass("loading");updateSearch(searchstring,currpage+1)});$("#prevbutton").click(function(){$("body").addClass("loading");updateSearch(searchstring,currpage-1)});$("#radio-choice-1,#radio-choice-2,#radio-choice-3").change(function(){$("#radio-choice-2").prop("checked")?($("#countrydiv").hide(),$("#id_country").val(""),$("#id_country").selectmenu("refresh"),
$("#statediv").show()):$("#radio-choice-3").prop("checked")?($("#statediv").hide(),$("#id_state").val(""),$("#id_state").selectmenu("refresh"),$("#countrydiv").show()):($("#countrydiv").hide(),$("#statediv").hide())});$("#backbutton").bind("click",function(a){$("#jobcontainer").hide();$("#resultcontainer").show();a.preventDefault()});document.addEventListener("backbutton",onBackKeyDown,!1)}function onBackKeyDown(){$("#jobcontainer").hide();$("#resultcontainer").show()}
checkSubmit=function(){locationstring=$("#radio-choice-2").prop("checked")?"?location_macro=us":$("#radio-choice-3").prop("checked")?"?location_macro=int":"?location_macro=";var a=""==$("#id_country").val()?"":"&country="+$("#id_country").val(),e=""==$("#id_state").val()?"":"&state="+$("#id_state").val(),f="&classification="+$("#id_classification").val(),c=$("#id_tags").val(),d="";if(null!=c)for(var b=0;b<c.length;b++)d+="&tags="+c[b];var c=!1==$("#id_nce").prop("checked")?"":"&nce=on",b=!1==$("#id_not_advanced_degree_required").prop("checked")?
"":"&not_advanced_degree_required=on",g="&keyword_search="+$("#search-basic").val();searchstring="http://www.peacecorps.gov/resources/returned/careerlink/jobs/"+locationstring+a+e+f+d+c+b+g;updateSearch(searchstring,1)};
updateSearch=function(a,e){$("body").addClass("loading");$.ajax({url:a+"&page="+e,type:"GET",success:function(a){datastring=$(a).find("div#main");$("#note").text(datastring.find("p.note").text());pages=Math.ceil(parseInt(datastring.find("p.note strong").text().split(" ")[0],10)/10);currpage=0==datastring.find("span.step-links span.current").length?1:parseInt(datastring.find("span.step-links span.current").text().split(" ")[1],10);$("#nextbutton").removeClass("ui-disabled");$("#prevbutton").removeClass("ui-disabled");
currpage==pages&&$("#nextbutton").addClass("ui-disabled");1==currpage&&$("#prevbutton").addClass("ui-disabled");$("#pagelabel").text("Page "+currpage+" of "+pages);$("#bottomcontainer").show();$("#datatable").html(datastring.find("#resultTable"));dataarray=$("#datatable tr:has(td)").map(function(b){var a=$("td",this);return{id:++b,postdate:a.eq(0).text().trim(),deadline:a.eq(1).text().trim(),link:"http://www.peacecorps.gov/"+a.eq(2).html().trim().substring(10,a.eq(2).html().trim().indexOf(">")-1),
jobtitle:a.eq(2).find("a").text(),organization:a.eq(3).text().trim(),city:a.eq(4).text().trim(),state:a.eq(5).text().trim(),country:a.eq(6).text().trim()}}).get();a='<ul data-role="listview"  data-autodividers="true" data-filter="false" id="reslist" >';for(var c=dataarray.length,d,b=0;b<c;b++)d="United States"!=dataarray[b].country?" ("+dataarray[b].city+", "+dataarray[b].country+")":" ("+dataarray[b].city+", "+dataarray[b].state+")",a+='<li  date="'+dataarray[b].postdate+'"><a class="joblink" href="'+
dataarray[b].link+'"><h3>'+dataarray[b].jobtitle+"</h3><h4>"+dataarray[b].organization+d+"</h4></a></li>";$("#resulttable").html(a+"</ul>");$("#reslist").listview({autodividers:!0,autodividersSelector:function(a){return a.attr("date")}}).listview("refresh");$("body").removeClass("loading");$("#jobcontainer").hide();$("#resultcontainer").show();$(".joblink").bind("click",function(a){$("body").addClass("loading");changePage(this.getAttribute("href"));a.preventDefault();return!1})}})};
changePage=function(a){$("body").addClass("loading");$.ajax({url:a,type:"GET",success:function(a){console.log("Ajax success");datastring=$(a).find("div#main");console.log(datastring);$("#jobtext").html(datastring);$("#jobtext a").bind("click",function(a){loadURL(this.getAttribute("href"));a.preventDefault();return!1});$("#jobcontainer").show();$("#resultcontainer").hide();$("body").removeClass("loading")}})};function loadURL(a){navigator.app.loadUrl(a,{openExternal:!0})}
$(document).on("pageinit",function(){$("#countrydiv").hide();$("#statediv").hide();addForm();updateSearch("http://www.peacecorps.gov/resources/returned/careerlink/jobs/?location_macro=&classification=&keyword_search=",1);searchstring="http://www.peacecorps.gov/resources/returned/careerlink/jobs/?location_macro=&classification=&keyword_search="});